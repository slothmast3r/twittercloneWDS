(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(194)}])},5138:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var s=n(5893);function a(e){let{small:t=!1,gray:n=!1,className:a="",...i}=e;return(0,s.jsx)("button",{className:"rounded-full transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50 ".concat(n?"bg-gray-400 hover:bg-gray-300 focus-visible:bg-gray-300":"bg-blue-500 hover:bg-blue-400 focus-visible:bg-blue-400"," ").concat(t?"px-2 py-1":"px-4 py-2 font-bold"," ").concat(a),...i})}},6545:function(e,t,n){"use strict";n.d(t,{x:function(){return x}});var s=n(5893),a=n(1664),i=n.n(a),l=n(8533),r=n(7843),o=n(3299),u=n(7152),c=n(9812),d=n(1975);function f(e){let{big:t=!1}=e;return(0,s.jsx)("div",{className:"flex justify-center p-2",children:(0,s.jsx)(u.Wet,{className:"animate-spin ".concat(t?"w-16 h-16":"w-10 h-10")})})}function x(e){let{tweets:t,isError:n,isLoading:a,fetchNewTweets:i,hasMore:r=!1}=e;return n?(0,s.jsx)("p",{children:"Error"}):a?(0,s.jsx)(f,{}):void 0==t||null==t||0===t.length?(0,s.jsx)("h2",{className:"text-2x1 my-4 text-center text-gray-500",children:"No tweets"}):(0,s.jsx)("ul",{children:(0,s.jsxs)(l.Z,{dataLength:t.length,next:i,hasMore:r,loader:(0,s.jsx)(f,{}),children:[t.map(e=>(0,s.jsx)(g,{...e},e.id))," "]})})}let h=new Intl.DateTimeFormat(void 0,{dateStyle:"short"});function g(e){let{id:t,user:n,content:a,createdAt:l,likeCount:o,likedByMe:u}=e,c=d.h.useContext(),f=d.h.tweet.toggleLike.useMutation({onSuccess:e=>{let{addedLike:n}=e;c.tweet.infiniteFeed.setInfiniteData({},e=>{if(null==e)return;let s=n?1:-1;return{...e,pages:e.pages.map(e=>({...e,tweets:e.tweets.map(e=>e.id===t?{...e,likeCount:e.likeCount+s,likedByMe:n}:e)}))}})}});return(0,s.jsxs)("li",{className:"flex gap-4 border-b px-4 py-4",children:[(0,s.jsx)(i(),{href:"profiles/".concat(n.id),children:(0,s.jsx)(r.m,{src:n.image})}),(0,s.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)(i(),{href:"profiles/".concat(n.id),className:"font-bold outline-none hover:underline focus-visible:underline",children:n.name}),(0,s.jsx)("span",{className:"text-gray-500",children:"-"}),(0,s.jsx)("span",{className:"text-gray-500",children:h.format(l)})]}),(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:a}),(0,s.jsx)(p,{onClick:function(){f.mutate({id:t})},isLoading:f.isLoading,likedByMe:u,likeCount:o})]})]})}function p(e){let{isLoading:t,onClick:n,likedByMe:a,likeCount:i}=e,l=(0,o.useSession)(),r=a?u.x5y:u.d$j;return"authenticated"!==l.status?(0,s.jsxs)("div",{className:"mb-1 mt-1 flex items-center gap-3 self-start text-gray-500",children:[(0,s.jsx)(r,{}),(0,s.jsxs)("span",{children:[" ",i]})]}):(0,s.jsxs)("button",{disabled:t,onClick:n,className:"dutarion-200 group flex items-center gap-1 self-start transition-colors ".concat(a?"text-red-500":"text-gray-500 hover:text-red-500 focus-visible:text-red-500"),children:[(0,s.jsx)(c.Z,{red:!0,children:(0,s.jsx)(r,{className:"transition-colors duration-200 ".concat(a?"fill-red-500":"fill-gray-500 group-hover:fill-red-500 group-focus-visible:fill-red-500")})}),(0,s.jsxs)("span",{children:[" ",i]})]})}},7843:function(e,t,n){"use strict";n.d(t,{m:function(){return l}});var s=n(5893),a=n(5675),i=n.n(a);function l(e){let{src:t,className:n=""}=e;return(0,s.jsx)("div",{className:"relative h-12 w-12 overflow-hidden rounded-full ".concat(n),children:null==t?null:(0,s.jsx)(i(),{fill:!0,src:t,alt:"Profile image",quality:100})})}},194:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var s=n(5893),a=n(3299),i=n(7294),l=n(6545),r=n(5138),o=n(7843),u=n(1975);function c(e){null!=e&&(e.style.height="0",e.style.height="".concat(e.scrollHeight,"px"))}function d(){let e=(0,a.useSession)();return"authenticated"!==e.status?null:(0,s.jsx)(f,{})}function f(){let e=(0,a.useSession)(),[t,n]=(0,i.useState)(""),l=(0,i.useRef)(),d=(0,i.useCallback)(e=>{c(e),l.current=e},[]),f=u.h.useContext();if((0,i.useLayoutEffect)(()=>{c(l.current)},[t]),"authenticated"!==e.status)return null;let x=u.h.tweet.create.useMutation({onSuccess:t=>{n(""),"authenticated"===e.status&&f.tweet.infiniteFeed.setInfiniteData({},n=>{var s,a,i;if(!(null==n?void 0:null===(s=n.pages)||void 0===s?void 0:s[0]))return;let l={...t,likeCount:0,likedByMe:!1,user:{id:e.data.user.id,name:null!==(a=e.data.user.name)&&void 0!==a?a:null,image:null!==(i=e.data.user.image)&&void 0!==i?i:null}};return{...n,page:[{...n.pages[0],tweets:[l,...n.pages[0].tweets]},...n.pages.slice(1)]}})}});return(0,s.jsxs)("form",{onSubmit:function(e){e.preventDefault(),x.mutate({content:t})},className:"flex flex-col gap-2 border-b px-4 py-y",children:[(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(o.m,{src:e.data.user.image}),(0,s.jsx)("textarea",{ref:d,onChange:e=>n(e.target.value),value:t,style:{height:0},className:"flex-grow resize-none overflow-hidden p-4 text-lg outline-none",placeholder:"What's happening"})]}),(0,s.jsx)(r.Z,{className:"self-end",children:"Tweet"})]})}let x=["Recent","Following"];function h(){let[e,t]=(0,i.useState)("Recent"),n=(0,a.useSession)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("header",{className:"sticky top-0 z-10 border-b bg-white pt-2",children:(0,s.jsx)("h1",{className:"font bold mb-2 px-4 text-lg",children:"Home"})}),"authenticated"===n.status&&(0,s.jsx)("div",{className:"flex",children:x.map(n=>(0,s.jsx)("button",{className:"\n                flex-grow p-2 hover:bg-gray-200 focus-visible:bg-gray-200 ".concat(n===e?"border-b-4 border-blue-500 font-bold":""),onClick:()=>t(n),children:n},n))}),(0,s.jsx)(d,{}),"Recent"===e?(0,s.jsx)(g,{}):(0,s.jsx)(p,{})]})}function g(){var e,t;let n=u.h.tweet.infiniteFeed.useInfiniteQuery({},{getNextPageParam:e=>e.nextCursor});return(0,s.jsx)(l.x,{tweets:null===(e=n.data)||void 0===e?void 0:e.pages.flatMap(e=>e.tweets),isError:n.isError,isLoading:n.isLoading,hasMore:null!==(t=n.hasNextPage)&&void 0!==t&&t,fetchNewTweets:n.fetchNextPage})}function p(){var e,t;let n=u.h.tweet.infiniteFeed.useInfiniteQuery({onlyFollowing:!0},{getNextPageParam:e=>e.nextCursor});return(0,s.jsx)(l.x,{tweets:null===(e=n.data)||void 0===e?void 0:e.pages.flatMap(e=>e.tweets),isError:n.isError,isLoading:n.isLoading,hasMore:null!==(t=n.hasNextPage)&&void 0!==t&&t,fetchNewTweets:n.fetchNextPage})}}},function(e){e.O(0,[855,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);