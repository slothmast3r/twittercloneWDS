"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={2104:e=>{e.exports=require("@next-auth/prisma-adapter")},3524:e=>{e.exports=require("@prisma/client")},3227:e=>{e.exports=require("next-auth")},3876:e=>{e.exports=require("next-auth/providers/discord")},6209:e=>{e.exports=require("next-auth/providers/facebook")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},72:e=>{e.exports=require("superjson")},6206:e=>{e.exports=import("@t3-oss/env-nextjs")},2937:e=>{e.exports=import("@trpc/server")},6282:e=>{e.exports=import("@trpc/server/adapters/next")},9926:e=>{e.exports=import("zod")},6816:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>u,routeModule:()=>p});var a=r(1802),s=r(7153),n=r(6249),o=r(5773),d=e([o]);o=(d.then?(await d)():d)[0];let l=a.PagesAPIRouteModule,u=(0,n.l)(o,"default"),c=(0,n.l)(o,"config"),p=new l({definition:{kind:s.x.PAGES_API,page:"/api/trpc/[trpc]",pathname:"/api/trpc/[trpc]",bundlePath:"",filename:""},userland:o});i()}catch(e){i(e)}})},5773:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>l});var a=r(6282),s=r(3206),n=r(5005),o=r(7847),d=e([a,s,n,o]);[a,s,n,o]=d.then?(await d)():d;let l=(0,a.createNextApiHandler)({router:n.q,createContext:o.uw,onError:"development"===s.O.NODE_ENV?({path:e,error:t})=>{console.error(`❌ tRPC failed on ${e??"<no-path>"}: ${t.message}`)}:void 0});i()}catch(e){i(e)}})},5005:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{q:()=>d});var a=r(8031),s=r(7847),n=r(5753),o=e([a,s,n]);[a,s,n]=o.then?(await o)():o;let d=(0,s.hA)({tweet:a.p,profile:n.q});i()}catch(e){i(e)}})},5753:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{q:()=>o});var a=r(7847),s=r(9926),n=e([a,s]);[a,s]=n.then?(await n)():n;let o=(0,a.hA)({getById:a.$y.input(s.z.object({id:s.z.string()})).query(async({input:{id:e},ctx:t})=>{let r=t.session?.user.id,i=await t.db.user.findUnique({where:{id:e},select:{name:!0,image:!0,_count:{select:{followers:!0,follows:!0,tweets:!0}},followers:null==r?void 0:{where:{id:r}}}});return null==i?null:{name:i.name,image:i.image,followersCount:i._count.followers,followsCount:i._count.follows,tweetsCount:i._count.tweets,isFollowing:i.followers.length>0}}),toggleFollow:a.U5.input(s.z.object({userId:s.z.string()})).mutation(async({input:{userId:e},ctx:t})=>{let r;let i=t.session.user.id,a=await t.db.user.findFirst({where:{id:e,followers:{some:{id:i}}}});return null==a?(await t.db.user.update({where:{id:e},data:{followers:{connect:{id:i}}}}),r=!0):(await t.db.user.update({where:{id:e},data:{followers:{connect:{id:i}}}}),r=!1),t.revalidateSSG?.(`/profile/${e}`),t.revalidateSSG?.(`/profile/${i}`),{addedFollow:r}})});i()}catch(e){i(e)}})},8031:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{p:()=>d});var a=r(7847),s=r(9926),n=e([a,s]);[a,s]=n.then?(await n)():n;let d=(0,a.hA)({infiniteProfileFeed:a.$y.input(s.z.object({userId:s.z.string(),limit:s.z.number().optional(),cursor:s.z.object({id:s.z.string(),createdAt:s.z.date()}).optional()})).query(async({input:{limit:e=10,userId:t,cursor:r},ctx:i})=>await o({limit:e,ctx:i,cursor:r,whereClause:{userId:t}})),infiniteFeed:a.$y.input(s.z.object({onlyFollowing:s.z.boolean().optional(),limit:s.z.number().optional(),cursor:s.z.object({id:s.z.string(),createdAt:s.z.date()}).optional()})).query(async({input:{limit:e=10,onlyFollowing:t=!1,cursor:r},ctx:i})=>{let a=i.session?.user.id;return await o({limit:e,ctx:i,cursor:r,whereClause:null!=a&&t?{user:{followers:{some:{id:a}}}}:void 0})}),create:a.U5.input(s.z.object({content:s.z.string()})).mutation(async({input:{content:e},ctx:t})=>{let r=await t.db.tweet.create({data:{content:e,userId:t.session.user.id}});return t.revalidateSSG?.(`/profile/${t.session.user.id}`),r}),toggleLike:a.U5.input(s.z.object({id:s.z.string()})).mutation(async({input:{id:e},ctx:t})=>{let r={tweetId:e,userId:t.session.user.id},i=await t.db.like.findUnique({where:{userId_tweetId:r}});return null==i?(await t.db.like.create({data:r}),{addedLike:!0}):(await t.db.like.delete({where:{userId_tweetId:r}}),{addedLike:!1})})});async function o({whereClause:e,ctx:t,limit:r,cursor:i}){let a;let s=t.session?.user.id,n=await t.db.tweet.findMany({take:r+1,cursor:i?{createdAt_id:i}:void 0,orderBy:[{createdAt:"desc"},{id:"desc"}],where:e,select:{id:!0,content:!0,createdAt:!0,_count:{select:{likes:!0}},likes:null!=s&&{where:{userId:s}},user:{select:{id:!0,name:!0,image:!0}}}});if(n.length>r){let e=n.pop();null!=e&&(a={id:e.id,createdAt:e.createdAt})}return{tweets:n.map(e=>({id:e.id,content:e.content,createdAt:e.createdAt,likeCount:e._count.likes,user:e.user,likedByMe:e.likes?.length>0})),nextCursor:a}}i()}catch(e){i(e)}})},7847:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{$y:()=>h,U5:()=>y,hA:()=>f,uw:()=>p});var a=r(2937),s=r(72),n=r.n(s),o=r(9926),d=r(314),l=r(7572),u=e([a,o,d,l]);[a,o,d,l]=u.then?(await u)():u;let c=e=>({session:e.session,revalidateSSG:e.revalidateSSG,db:l.db}),p=async e=>{let{req:t,res:r}=e,i=await (0,d.W)({req:t,res:r});return c({session:i,revalidateSSG:r.revalidate})},w=a.initTRPC.context().create({transformer:n(),errorFormatter:({shape:e,error:t})=>({...e,data:{...e.data,zodError:t.cause instanceof o.ZodError?t.cause.flatten():null}})}),f=w.router,h=w.procedure,m=w.middleware(({ctx:e,next:t})=>{if(!e.session?.user)throw new a.TRPCError({code:"UNAUTHORIZED"});return t({ctx:{session:{...e.session,user:e.session.user}}})}),y=w.procedure.use(m);i()}catch(e){i(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[222,314],()=>r(6816));module.exports=i})();